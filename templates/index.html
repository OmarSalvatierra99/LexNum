<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LexNum · Conversor Numérico Institucional</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <!-- =========================================================
       HEADER
       ========================================================= -->
  <header class="header-fixed">
    <div class="header-content">
      <img src="{{ url_for('static', filename='img/ofs_logo.png') }}" alt="Logo OFS" class="ofs-logo">
      <div class="header-text">
        <h1>LexNum</h1>
        <p>Conversor Numérico Institucional · OFS Tlaxcala</p>
      </div>
    </div>
  </header>

  <!-- =========================================================
       MAIN
       ========================================================= -->
  <main class="main-content">
    <section class="tool-card">
      <h2>Conversión en tiempo real</h2>
      <p>Escribe un número para ver su versión en texto con formato oficial.</p>

      <div class="input-group">
        <input type="number" id="numero" placeholder="Ejemplo: 1523.45" oninput="convertirNumero()">
        <div id="spinner" class="loader" hidden></div>
      </div>

      <p id="resultadoTexto" class="resultado"></p>

      <hr class="divider">

      <h2>O cargar archivo Excel</h2>
      <p>Se acepta columna llamada <strong>Número, Numero, numero, NUMERO o Num</strong>.</p>

      <form id="excelForm" enctype="multipart/form-data">
        <input type="file" name="archivo" accept=".xlsx" required>
        <button type="submit">Procesar y descargar</button>
      </form>

      <p id="statusMessage" class="status"></p>
    </section>
  </main>

  <!-- =========================================================
       FOOTER
       ========================================================= -->
  <footer class="dashboard-footer">
    © Órgano de Fiscalización Superior del Estado de Tlaxcala — Sistema LexNum
  </footer>

  <!-- =========================================================
       SCRIPTS
       ========================================================= -->
  <script>
    // Conversión numérica instantánea
    async function convertirNumero() {
      const numero = document.getElementById("numero").value.trim();
      const out = document.getElementById("resultadoTexto");
      const loader = document.getElementById("spinner");
      out.textContent = "";
      if (!numero) return;
      loader.hidden = false;

      try {
        const r = await fetch("/convertir_texto", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ numero })
        });
        const data = await r.json();
        out.textContent = data.texto || "Error al convertir.";
      } catch {
        out.textContent = "Error de conexión.";
      } finally {
        loader.hidden = true;
      }
    }

    // Procesar archivo Excel y descargar resultado
    document.getElementById("excelForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const status = document.getElementById("statusMessage");
      status.textContent = "Procesando…";

      try {
        const fd = new FormData(e.target);
        const resp = await fetch("/convertir_excel", { method: "POST", body: fd });

        if (!resp.ok) {
          const data = await resp.json().catch(() => ({}));
          status.textContent = data.error || "Error al procesar.";
          return;
        }

        // Descargar archivo directamente
        const blob = await resp.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "resultado_lexnum.xlsx";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        status.textContent = "Archivo generado y descargado.";
      } catch {
        status.textContent = "Error de red.";
      }
    });
  </script>
</body>
</html>

